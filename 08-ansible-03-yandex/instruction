В этом разделе ClickHouse устанавливается на хосты в группе clickhouse.
Он определяет обработчик с именем "Start clickhouse service", который перезапустит службу ClickHouse при запуске.
Задачи заключаются в следующем:
Он загружает пакеты ClickHouse, указанные в переменной clickhouse_packages, из репозитория ClickHouse и сохраняет их локально.
Если загрузка завершается неудачно, происходит возврат к загрузке пакета "clickhouse-common-static".
Он устанавливает загруженные пакеты ClickHouse с помощью yum.
После установки он запускает обработчик "Запустить службу clickhouse" для перезапуска службы ClickHouse.
Он сбрасывает обработчики, чтобы гарантировать выполнение обработчика для перезапуска службы ClickHouse.
Он создает базу данных ClickHouse с именем "журналы", если она еще не существует.
- Установить вектор:
В этом разделе устанавливается Vector на хосты в группе vector.
Он определяет обработчик с именем "Start Vector service", который перезапустит векторную службу при запуске.
Задачи заключаются в следующем:
Он загружает векторный пакет из репозитория Timber и сохраняет его локально.
Он устанавливает загруженный векторный пакет с помощью yum.
После установки он запускает обработчик "Запустить векторную службу" для перезапуска векторной службы.
- Общая конфигурация для узлов lighthouse:
Этот раздел гарантирует, что хосты lighthouse group используют Python 3 в качестве своего интерпретатора.
- Установите Nginx:
В этом разделе устанавливается Nginx на хосты в группе lighthouse.
Он определяет обработчик с именем "Перезапустить службу Nginx", который перезапустит службу Nginx при запуске.
Задачи заключаются в следующем:
Он устанавливает Nginx с помощью apt и гарантирует, что кэш пакетов обновлен.
После установки он запускает обработчик "Перезапустить службу Nginx" для перезапуска службы Nginx.
- Установить Install lighthouse:
Этот раздел устанавливает Lighthouse на хосты в группе lighthouse.
Он определяет обработчик с именем "Перезапустить службу Nginx", который перезапустит службу Nginx при запуске.
Задачи заключаются в следующем:
Он устанавливает пакет "unzip" с помощью apt и гарантирует, что кэш пакетов обновлен.
Он загружает дистрибутив Lighthouse из репозитория VKCOM на GitHub и сохраняет его локально.
Он разархивирует дистрибутив Lighthouse в каталог "/var/www/html/", который обычно является корневым веб-каталогом для Nginx.
Он создает конфигурационный файл Nginx для Lighthouse, используя шаблон Jinja2.
Он удаляет загруженный архив дистрибутива Lighthouse
